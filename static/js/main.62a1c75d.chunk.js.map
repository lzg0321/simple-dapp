{"version":3,"sources":["App.js","reportWebVitals.js","index.js"],"names":["App","props","connect","a","initWeb3","initContract","web3","eth","getAccounts","accounts","console","log","account","setState","connected","fetchBalance","fetchMinterAccount","onReceiverChange","e","address","target","value","receiverAddress","onTransferAmountChange","amount","transferAmount","onMintReceiverChange","mintReceiverAddress","onMintAmountChange","mintAmount","onMint","contract","methods","mint","state","send","from","on","hash","txHash","status","action","receipt","onTransfer","minterAccount","ethBalance","balance","netVersion","window","ethereum","enable","this","Web3","fetchNetworkId","net","getId","Contract","abi","initContractEvent","events","Sent","filter","to","fromBlock","event","balances","call","getBalance","utils","fromWei","minter","className","onClick","isMinter","React","Component","DAppInfo","type","onChange","href","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.62a1c75d.chunk.js","sourcesContent":["import React from 'react';\nimport Web3 from 'web3'\nimport './App.css';\nimport abi from './abi.json';\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      connected: false, // 是否连接meta mask\n      account: '', // meta mask的以太坊账户\n      minterAccount: '', // 铸币者的以太坊账户\n      mintReceiverAddress: '', // 铸币的接收地址\n      mintAmount: '', // 铸币数量\n      ethBalance: 0, // 以太坊余额\n      balance: 0, // 币余额\n      txHash: '', // 广播的交易id\n      status: '', // 交易状态\n      netVersion: '' // network id\n    }\n  }\n  /**\n   * 初始化web3\n   */\n  async initWeb3 () {\n    console.log('window.ethereum', window.ethereum)\n    await window.ethereum.enable();\n    this.web3 = new Web3(window.ethereum);\n    window.ethereum.on('networkChanged',  () => {\n      console.log('changed net')\n      this.fetchNetworkId();\n    });\n    this.fetchNetworkId();\n  }\n\n  /**\n   * 拿到网络id，不同的网络对应不同的id\n   * @returns {Promise<void>}\n   */\n  async fetchNetworkId () {\n    const netVersion = await this.web3.eth.net.getId();\n    console.log('netVersion', netVersion)\n    this.setState({\n      netVersion\n    });\n  }\n\n  /**\n   * 初始化合约\n   */\n  initContract () {\n    const contractAddress = '0xfa95506583310999dc823f45CaeD5faE3c2ED1b9';\n    const contract = new this.web3.eth.Contract(abi, contractAddress);\n    this.contract = contract;\n    this.initContractEvent();\n  }\n\n  /**\n   * 监听转账事件，当监听到当前账户收到币后，刷新余额\n   */\n  initContractEvent () {\n    this.contract.events.Sent({\n      filter: {to: [this.state.account]},\n      fromBlock: 0\n    })\n      .on('change', (event) => {\n        this.fetchBalance(this.state.account)\n      });\n  }\n\n  /**\n   * 请求余额\n   */\n  async fetchBalance (account) {\n    const balance = await this.contract.methods.balances(account).call();\n    const ethBalance = await this.web3.eth.getBalance(account);\n    console.log('ethBalance', ethBalance)\n    this.setState({\n      balance,\n      ethBalance: Web3.utils.fromWei(ethBalance)\n    })\n  }\n\n  /**\n   * 请求铸币者地址\n   */\n  async fetchMinterAccount () {\n    const minterAccount = await this.contract.methods.minter().call();\n    this.setState({\n      minterAccount,\n    })\n  }\n  /**\n   * 连接Meta Mask的以太坊账户\n   * @returns {Promise<void>}\n   */\n  connect  = async () => {\n    await this.initWeb3();\n    this.initContract();\n\n    const accounts = await this.web3.eth.getAccounts();\n    console.log('accounts', accounts)\n    const account = accounts[0];\n    this.setState({\n      connected: true,\n      account: account\n    });\n    this.fetchBalance(account);\n    this.fetchMinterAccount();\n  }\n  /**\n   * 记录收款地址\n   * @param e\n   */\n  onReceiverChange = (e) =>{\n    const address = e.target.value;\n    this.setState({\n      receiverAddress: address\n    })\n  }\n  /**\n   * 记录转出数量\n   * @param e\n   */\n  onTransferAmountChange = (e) => {\n    const amount = e.target.value;\n    this.setState({\n      transferAmount: amount\n    })\n  }\n  /**\n   * 记录铸币的接收地址\n   * @param e\n   */\n  onMintReceiverChange = (e) =>{\n    const address = e.target.value;\n    this.setState({\n      mintReceiverAddress: address\n    })\n  }\n  /**\n   * 记录铸币数量\n   * @param e\n   */\n  onMintAmountChange = (e) => {\n    const amount = e.target.value;\n    this.setState({\n      mintAmount: amount\n    })\n  }\n  /**\n   * 铸币\n   */\n  onMint = () => {\n    // 在此调用合约方法mint\n    this.contract.methods.mint(this.state.mintReceiverAddress, this.state.mintAmount)\n      .send({\n        from: this.state.account\n      })\n      .on('transactionHash', (hash) => {\n        // 交易广播到节点，等待打包\n        this.setState({\n          txHash: hash,\n          status: 'pending',\n          action: '铸币',\n        });\n      })\n      .on('receipt', (receipt) => {\n        // 交易已被确认\n        this.setState({\n          status: 'confirmed',\n        });\n        // 刷新余额信息\n        this.fetchBalance(this.state.account);\n      });\n  }\n  /**\n   * 转账\n   */\n  onTransfer = () => {\n    // 在此调用合约方法send\n    console.log('transfer', this.state.receiverAddress, this.state.transferAmount, this.state.account)\n    this.contract.methods.send(this.state.receiverAddress, this.state.transferAmount)\n      .send({\n        from: this.state.account\n      })\n      .on('transactionHash', (hash) => {\n        // 交易广播到节点，等待打包\n        this.setState({\n          txHash: hash,\n          status: 'pending',\n          action: '转账',\n        });\n      })\n      .on('receipt', (receipt) => {\n        // 交易已被确认\n        this.setState({\n          status: 'confirmed',\n        });\n      });\n  }\n  render() {\n    return (\n      <div className=\"App\">\n        {\n          this.state.netVersion && this.state.netVersion !== 42 &&\n          <div className={'warn'}>\n            链接的网络不正确<br/>\n            请打开MetaMask切换至Kovan测试网络\n          </div>\n        }\n        <header className=\"App-header\">\n          DApp Coin\n        </header>\n        {\n          !this.state.connected && <button onClick={this.connect} className={'connectBtn'}>Connect MetaMask</button>\n        }\n        {\n          this.state.connected && <DAppInfo\n            onTransfer={this.onTransfer}\n            onReceiverChange={this.onReceiverChange}\n            onTransferAmountChange={this.onTransferAmountChange}\n            onMint={this.onMint}\n            onMintReceiverChange={this.onMintReceiverChange}\n            onMintAmountChange={this.onMintAmountChange}\n            ethBalance={this.state.ethBalance}\n            balance={this.state.balance}\n            account={this.state.account}\n            action={this.state.action}\n            txHash={this.state.txHash}\n            status={this.state.status}\n            isMinter={this.state.minterAccount === this.state.account}\n          />\n        }\n      </div>\n    );\n  }\n}\n\nexport default App;\n\n\nclass DAppInfo extends React.Component {\n  render() {\n    return <div className={'infoContainer'}>\n      <div className={'infoItem'}>\n        <label>账户地址：</label>\n        <span>\n          {\n            this.props.account\n          }\n        </span>\n      </div>\n      <div className={'infoItem'}>\n        <label>ETH余额：</label>\n        <span>\n          {\n            this.props.ethBalance\n          }\n        </span>\n      </div>\n      <div className={'infoItem'}>\n        <label>Coin余额：</label>\n        <span>\n          {\n            this.props.balance\n          }\n        </span>\n      </div>\n      {\n        this.props.isMinter &&  <div className={'transferCon'}>\n          <h2>铸币</h2>\n          <div className={'transferItem'}>\n            <label>收币地址：</label>\n            <input type='text' onChange={this.props.onMintReceiverChange}/>\n          </div>\n          <div className={'transferItem'}>\n            <label>铸币数量：</label>\n            <input type='number' onChange={this.props.onMintAmountChange}/>\n          </div>\n          <button onClick={this.props.onMint}>确定铸币</button>\n        </div>\n      }\n      <div className={'transferCon'}>\n        <h2>转账</h2>\n        <div className={'transferItem'}>\n          <label>收款地址：</label>\n          <input type='text' onChange={this.props.onReceiverChange}/>\n        </div>\n        <div className={'transferItem'}>\n          <label>转出数额：</label>\n          <input type='number' onChange={this.props.onTransferAmountChange}/>\n        </div>\n        <button onClick={this.props.onTransfer}>确定转出</button>\n      </div>\n      {\n        this.props.txHash && <div>\n          <h2>记录</h2>\n          <div>\n            <label>交易动作：</label>\n            <span>\n            {\n              this.props.action\n            }\n          </span>\n          </div>\n          <div>\n            <label>交易哈希：</label>\n            <a href={`https://kovan.etherscan.io/tx/${this.props.txHash}`}>\n            {\n              this.props.txHash\n            }\n          </a>\n          </div>\n          <div>\n            <label>交易状态：</label>\n            <span>\n            {\n              this.props.status\n            }\n          </span>\n          </div>\n        </div>\n      }\n    </div>\n  }\n}\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}