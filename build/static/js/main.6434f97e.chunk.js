(this.webpackJsonpdappdemo=this.webpackJsonpdappdemo||[]).push([[0],{197:function(t){t.exports=JSON.parse('[{"inputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"send","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"from","type":"address"},{"indexed":false,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"Sent","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balances","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"minter","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"}]')},204:function(t,e,n){},218:function(t,e){},241:function(t,e){},243:function(t,e){},257:function(t,e){},320:function(t,e){},322:function(t,e){},354:function(t,e){},359:function(t,e){},361:function(t,e){},368:function(t,e){},381:function(t,e){},399:function(t,e){},410:function(t,e){},413:function(t,e){},465:function(t,e,n){},468:function(t,e,n){"use strict";n.r(e);var a=n(34),s=n.n(a),c=n(194),i=n.n(c),r=(n(204),n(16)),o=n.n(r),u=n(60),h=n(5),l=n(7),d=n(11),p=n(10),f=n(104),j=n.n(f),b=(n(465),n(197)),m=n(6),v=function(t){Object(d.a)(n,t);var e=Object(p.a)(n);function n(t){var a;return Object(h.a)(this,n),(a=e.call(this,t)).connect=Object(u.a)(o.a.mark((function t(){var e,n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.initWeb3();case 2:return a.initContract(),t.next=5,a.web3.eth.getAccounts();case 5:e=t.sent,console.log("accounts",e),n=e[0],a.setState({connected:!0,account:n}),a.fetchBalance(n),a.fetchMinterAccount();case 11:case"end":return t.stop()}}),t)}))),a.onReceiverChange=function(t){var e=t.target.value;a.setState({receiverAddress:e})},a.onTransferAmountChange=function(t){var e=t.target.value;a.setState({transferAmount:e})},a.onTransferAmountChange=function(t){var e=t.target.value;a.setState({transferAmount:e})},a.onMintReceiverChange=function(t){var e=t.target.value;a.setState({mintReceiverAddress:e})},a.onMintAmountChange=function(t){var e=t.target.value;a.setState({mintAmount:e})},a.onMint=function(){a.contract.methods.mint(a.state.mintReceiverAddress,a.state.mintAmount).send({from:a.state.account}).on("transactionHash",(function(t){a.setState({txHash:t,status:"pending",action:"\u94f8\u5e01"})})).on("receipt",(function(t){a.setState({status:"confirmed"}),a.fetchBalance(a.state.account)}))},a.onTransfer=function(){a.contract.methods.send(a.state.receiverAddress,a.state.transferAmount).send({from:a.state.account}).on("transactionHash",(function(t){a.setState({txHash:t,status:"pending",action:"\u8f6c\u8d26"})})).on("receipt",(function(t){a.setState({status:"confirmed"})}))},a.state={connected:!1,account:"",minterAccount:"",mintReceiverAddress:"",mintAmount:"",ethBalance:0,balance:0,txHash:"",status:""},a}return Object(l.a)(n,[{key:"componentDidMount",value:function(){}},{key:"initWeb3",value:function(){var t=Object(u.a)(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("window.ethereum",window.ethereum),t.next=3,window.ethereum.enable();case 3:this.web3=new j.a(window.ethereum);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initContract",value:function(){var t=new this.web3.eth.Contract(b,"0xfa95506583310999dc823f45CaeD5faE3c2ED1b9");this.contract=t,this.initContractEvent()}},{key:"initContractEvent",value:function(){var t=this;this.contract.events.Sent({filter:{to:[this.state.account]},fromBlock:0}).on("data",(function(e){t.fetchBalance(t.state.account)}))}},{key:"fetchBalance",value:function(){var t=Object(u.a)(o.a.mark((function t(e){var n,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contract.methods.balances(e).call();case 2:return n=t.sent,t.next=5,this.web3.eth.getBalance(e);case 5:a=t.sent,console.log("ethBalance",a),this.setState({balance:n,ethBalance:j.a.utils.fromWei(a)});case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"fetchMinterAccount",value:function(){var t=Object(u.a)(o.a.mark((function t(){var e;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.contract.methods.minter().call();case 2:e=t.sent,this.setState({minterAccount:e});case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)("header",{className:"App-header",children:"DApp Coin"}),!this.state.connected&&Object(m.jsx)("button",{onClick:this.connect,className:"connectBtn",children:"Connect MetaMask"}),this.state.connected&&Object(m.jsx)(x,{onTransfer:this.onTransfer,onReceiverChange:this.onReceiverChange,onTransferAmountChange:this.onTransferAmountChange,onMint:this.onMint,onMintReceiverChange:this.onMintReceiverChange,onMintAmountChange:this.onMintAmountChange,ethBalance:this.state.ethBalance,balance:this.state.balance,account:this.state.account,action:this.state.action,txHash:this.state.txHash,status:this.state.status,isMinter:this.state.minterAccount===this.state.account})]})}}]),n}(s.a.Component),x=function(t){Object(d.a)(n,t);var e=Object(p.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(m.jsxs)("div",{className:"infoContainer",children:[Object(m.jsxs)("div",{className:"infoItem",children:[Object(m.jsx)("label",{children:"\u8d26\u6237\u5730\u5740\uff1a"}),Object(m.jsx)("span",{children:this.props.account})]}),Object(m.jsxs)("div",{className:"infoItem",children:[Object(m.jsx)("label",{children:"ETH\u4f59\u989d\uff1a"}),Object(m.jsx)("span",{children:this.props.ethBalance})]}),Object(m.jsxs)("div",{className:"infoItem",children:[Object(m.jsx)("label",{children:"Coin\u4f59\u989d\uff1a"}),Object(m.jsx)("span",{children:this.props.balance})]}),this.props.isMinter&&Object(m.jsxs)("div",{className:"transferCon",children:[Object(m.jsx)("h2",{children:"\u94f8\u5e01"}),Object(m.jsxs)("div",{className:"transferItem",children:[Object(m.jsx)("label",{children:"\u6536\u5e01\u5730\u5740\uff1a"}),Object(m.jsx)("input",{type:"text",onChange:this.props.onMintReceiverChange})]}),Object(m.jsxs)("div",{className:"transferItem",children:[Object(m.jsx)("label",{children:"\u94f8\u5e01\u6570\u91cf\uff1a"}),Object(m.jsx)("input",{type:"number",onChange:this.props.onMintAmountChange})]}),Object(m.jsx)("button",{onClick:this.props.onMint,children:"\u786e\u5b9a\u94f8\u5e01"})]}),Object(m.jsxs)("div",{className:"transferCon",children:[Object(m.jsx)("h2",{children:"\u8f6c\u8d26"}),Object(m.jsxs)("div",{className:"transferItem",children:[Object(m.jsx)("label",{children:"\u6536\u6b3e\u5730\u5740\uff1a"}),Object(m.jsx)("input",{type:"text",onChange:this.props.onReceiverChange})]}),Object(m.jsxs)("div",{className:"transferItem",children:[Object(m.jsx)("label",{children:"\u8f6c\u51fa\u6570\u989d\uff1a"}),Object(m.jsx)("input",{type:"number",onChange:this.props.onTransferAmountChange})]}),Object(m.jsx)("button",{onClick:this.props.onTransfer,children:"\u786e\u5b9a\u8f6c\u51fa"})]}),this.props.txHash&&Object(m.jsxs)("div",{children:[Object(m.jsx)("h2",{children:"\u8bb0\u5f55"}),Object(m.jsxs)("div",{children:[Object(m.jsx)("label",{children:"\u4ea4\u6613\u52a8\u4f5c\uff1a"}),Object(m.jsx)("span",{children:this.props.action})]}),Object(m.jsxs)("div",{children:[Object(m.jsx)("label",{children:"\u4ea4\u6613\u54c8\u5e0c\uff1a"}),Object(m.jsx)("span",{children:this.props.txHash})]}),Object(m.jsxs)("div",{children:[Object(m.jsx)("label",{children:"\u4ea4\u6613\u72b6\u6001\uff1a"}),Object(m.jsx)("span",{children:this.props.status})]})]})]})}}]),n}(s.a.Component),O=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,471)).then((function(e){var n=e.getCLS,a=e.getFID,s=e.getFCP,c=e.getLCP,i=e.getTTFB;n(t),a(t),s(t),c(t),i(t)}))};i.a.render(Object(m.jsx)(s.a.StrictMode,{children:Object(m.jsx)(v,{})}),document.getElementById("root")),O()}},[[468,1,2]]]);
//# sourceMappingURL=main.6434f97e.chunk.js.map